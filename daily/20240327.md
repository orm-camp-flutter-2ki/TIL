# <span style="color:lime">20240311 í”ŒëŸ¬í„° ê³¼ì • 4ì£¼ì°¨ ìˆ˜ìš”ì¼</span>   

## 1. ê¼­ ê¸°ì–µí•  ê²ƒ! ğŸ…
### ê³¼ì œë¦¬ë·°
#### í´ë” êµ¬ì¡° (ì˜ˆì‹œ)
* [data_source]
	* ã„´subway_api.dart
	* ã„´todo_api.dart
* [model]
	* ã„´todo.dart
	* ã„´subway.dart
* [repository]
	* ã„´subway_repository (abstract interface)
	* ã„´subway_repository_impl (implement)  
	* ã„´todo_repository (abstract interface)
	* ã„´todo_repository_impl (implement)

#### List<dynamic> -> List<Todo>
```dart
@override
Future<List<Todo>> getCompletedTodos() async {
	final results = await _api.getTodos(); // resultsëŠ” List<dynamic>
	return results.where((e) => e.completed == true).toList();	
}

```
#### ì´ë¦„ ìˆœ 10ë²ˆì§¸ê¹Œì§€, take(int)í•¨ìˆ˜
```dart
Future<List<User>> getUsersTop10ByUserName() async {
	final results = await _api.getUsers(); 
	return results
		.sorted((a, b) => a.userName.compareTo(b.userName))
		.take(10) // ì•ì—ì„œë¶€í„° 10ê°œë§Œ ê°€ì ¸ì˜´
		.toList();
}

```
#### ì´ë¦„ ìˆœ 10ë²ˆì§¸ê¹Œì§€, test code
```dart
	final repository = AlbumRepositoryImpl()
	// repositoryì˜ í•¨ìˆ˜ë¡œ ê°€ì ¸ì˜¨ ë°ì´í„°
	final result = await repository.getAlbumsTop10();
	// mapì´ë‚˜ Str ë“±ìœ¼ë¡œ ê°€ì ¸ì˜¨ ê²°ê³¼ -> Comment ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
	final expected = expectedComments.map((e) => Comment.fromJson(e)).toList()

	expect(results.equals(expected), true);
```
* list, setì˜ ê²½ìš° list.equals() í•¨ìˆ˜ë¡œ ë¹„êµ
* Mapì˜ ê²½ìš°ì—ëŠ” DeepCollectionEquality().equals()ë¥¼ ì¨ì•¼í•¨


#### baseUrl 
```dart
// ì€ë‹‰í™”, final, ìµœìƒìœ„ static ë³€ìˆ˜ë¡œ ì„ ì–¸
final _baseUrl = 'https:// ...';

Future<List<Comment>> getComments() async {
	final response = await http.get(Uri.parse('$_baseUrl/comments'));
}
Future<List<Album>> getAlbums() async {
	final response = await http.get(Uri.parse('$_baseUrl/albums'));

}

```
#### Post
```dart
Future<List<Post>> getPosts({int? page, int? limit})
// optional parameterë¡œ ë°›ì•„ì„œ ë°›ëŠ” ê°’ ì—†ìœ¼ë©´ findAll
```

#### Status Codeì™€ ì—ëŸ¬ì²˜ë¦¬
- ì˜ˆì™¸ ì²˜ë¦¬ëŠ” repositoryì˜ ì±…ì„ ì¤‘ í•˜ë‚˜ì„
	- ì¦‰, repositoryì—ì„œ ë°ì´í„° ë°›ì„ ë•Œ ì—ëŸ¬ì²˜ë¦¬í•´ì•¼ í•¨
	- abstracë¡œ ë‚˜ëˆˆ ê²½ìš°ì—ëŠ” implì—ì„œ ì²˜ë¦¬
	- ë‹¤ë§Œ í˜„ì¬ ë°°ìš´ ë°”ë¡œëŠ” ì—ëŸ¬ë°œìƒ ì‹œ ë¹ˆ list ë°˜í™˜ ë“± í•  ìˆ˜ ìˆëŠ” ê²Œ ë³„ë¡œ ì—†ê¸´ í•¨
	(ì‹¤ì œë¡œëŠ” ì–´ë–¤ ì²˜ë¦¬ë¥¼?)
- ë„¤íŠ¸ì›Œí¬ê°€ ëŠì–´ì ¸ìˆëŠ” ê²½ìš°ì—ëŠ” Exceptionì€ ì•„ë‹ˆì§€ë§Œ ì˜ë„ì ìœ¼ë¡œ Exceptionìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼í•¨
- [ì •ë¦¬] 
	1. apiì—ì„œëŠ” statusCode ê²€ì‚¬ (ì‚¼í•­ì—°ì‚°ì)
	2. repositoryì—ì„œëŠ” try catchë¡œ ì—ëŸ¬ì²˜ë¦¬

#### ì¢‹ì€ ì½”ë“œ
![alt text](image-44.png)
ë³´ë‹¨
![alt text](image-45.png)

ì²˜ëŸ¼ returnì€ ë©”ì„œë“œ ë§ˆì§€ë§‰ì—ì„œë§Œ

#### [extension](https://dart.dev/language/extension-methods)
>ê¸°ëŠ¥ì„ ë§Œë“¤ë ¤ë©´ ë³´í†µ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê¸°ëŠ¥ì„ í™•ì¥í•˜ë ¤ë©´ ìƒì†í•˜ì§€ë§Œ<br>
>Extensionì€ ìƒì†ì„ ì•ˆí•´ë„ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ

```dart
class MyString extends String{
	int parseInt() {}
}	
// String ë“±ì˜ ê²½ìš°ì—ëŠ” finalë¡œ ì„ ì–¸ë˜ì–´ ìˆì–´ì„œ ìƒì†ì´ ë§‰í˜€ìˆìŒ
```
```dart
// List<dynamic>-> List<T> íƒ€ì… ì „í™˜í•˜ëŠ” extensionë„ ë§Œë“¤ ìˆ˜ ìˆìŒ
extension ListMapToListObject<T> on List<T> {
	List<T> toListObject(){ // Të„ ë“¤ì–´ê°€ì„œ Genericë„ ë„£ì–´ì•¼ í•¨
		this.map((e) => T.fromJson(e)).toList();
	}
}
```
cf) list.equals()ë„ extensionì„ (ê¸°ëŠ¥ í™•ì¥ ë¬´í•œíˆ ê°€ëŠ¥í•¨)

### Test Code
#### Test Double
**[https://tecoble.techcourse.co.kr/post/2020-09-19-what-is-test-double/](https://tecoble.techcourse.co.kr/post/2020-09-19-what-is-test-double/)**

í…ŒìŠ¤íŠ¸ ë”ë¸”ì˜ ì¢…ë¥˜
- Dummy
- Fake
- Stub
- Spy
- Mock

Test ê²½ê³„ê°€ ëª¨í˜¸í•˜ë¯€ë¡œ ìš©ì–´ì— ì§‘ì°©í•˜ì§€ ë§ ê²ƒ 


#### Mock ê°ì²´ í™œìš©
JsonPlaceHolderApi ë“±

#### í…ŒìŠ¤íŠ¸ ìš©ì´ì„±ğŸ’¥
- í…ŒìŠ¤íŠ¸ë¥¼ í¸í•˜ê²Œ í•˜ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì˜ ì¨ì•¼í•¨<br><br>
- ì¦‰, ì˜ì¡´í•˜ì§€ ì•Šê²Œ, êµì²´í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì•¼ í•¨
- ë°©ë²•1) ì˜ì¡´í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ Interfaceë¡œ ë³€ê²½

	![alt text](image-46.png)

	ì°¸ê³ ) https://dart.dev/language#interfaces-and-abstract-classes

- ë°©ë²•2) ì˜ì¡´í•˜ëŠ” í´ë˜ìŠ¤ê°€ Mockë°ì´í„°ë¥¼ ì£¼ê²Œ í•¨	

[ì˜ˆì‹œ]
```dart
case1

* main()
* ã„´ PostRepositoryImpl (ì˜ì¡´)
	* ã„´ JsonPlaceHolderApi (ì˜ì¡´)

case2.
* main() (ì‚¬ìš©)
	* ã„´PostRepositry(I) (êµì²´ê°€ëŠ¥)
	* ã„´PostRepositoryImpl ã„´MockPostRepositoryImpl (êµ¬í˜„)
	* ã„´JsonPlaceHolderApi

case3.
// testê°€ ì–´ë ¤ìš´ êµ¬ì¡°ë¥¼ ê°œì„ 
class TodoRepositoryImpl implements TodoRepository {
	final TodoApi _api = TodoApi();
}

class TodoRepositoryImpl implements TodoRepository {
	final TodoApi _api;
	TodoRepositoryImpl(this._api);
}
```
case4.
http Clientë¥¼ êµì²´í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•œ TodoApi

![alt text](image-47.png)

* http ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” client()ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , êµì²´ë„ ê°€ëŠ¥í•˜ë‹¤.

case5.
Mock ê°ì²´ë¥¼ í™œìš©
http ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ìš© MockClient ê°ì²´ë¥¼ ì œê³µí•œë‹¤.
![alt text](image-48.png)


- ë°©ë²•3. í´ë˜ìŠ¤ë¥¼ êµ¬í˜„ (ë³€ì¹™) 
	- Dartì˜ ëŠìŠ¨í•œ ê·œì¹™ì„ ì‘ìš©
	```dart
	class MockTodoApi implements TodoApi{}
	```

* [mockito (ê°ì²´ ì‘ì„± Testìš© ë¼ì´ë¸ŒëŸ¬ë¦¬)](https://github.com/dart-lang/mockito/blob/master/NULL_SAFETY_README.md)

#### ì‹±ê¸€í†¤, factory ìƒì„±ì
![alt text](image-43.png)

#### ì¢‹ì€ Unit Testì˜ 6ê°€ì§€ ì¡°ê±´(FRIEND)
1. Fase
2. Reliable
3. Independent
4. Ease of Maintenance
5. Nearly compacted code
6. Dependencies should be less


## 2. í•œì¤„ ì •ë¦¬ ğŸ§¹
1. final ë³€ìˆ˜ì— ëŒ€í•œ ìƒì„±ìì—ëŠ” const ë¶™ì¼ ê²ƒ
2. ê¸°ëŠ¥ í´ë˜ìŠ¤ ê°ì²´ ìƒì„± ì½”ë“œëŠ” ìµœìƒë‹¨ì—(static) ë‘ê³  final(+ private)ë¡œ í•¨
3. implì—ì„œ apië°›ì•„ ë°ì´í„° ìš”ì²­í•˜ëŠ” í•¨ìˆ˜(ex. getAlbums()ë“±)ëŠ” async ìˆì–´ë„, ì—†ì–´ë„ ë¨..
4. returnì€ ë©”ì„œë“œ ë§ˆì§€ë§‰ì—ì„œë§Œ í•˜ì.

