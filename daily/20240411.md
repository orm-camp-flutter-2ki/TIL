# <span style="color:lime">202404 í”ŒëŸ¬í„° ê³¼ì • 7ì£¼ì°¨ ëª©ìš”ì¼</span>   

## 1. ê¼­ ê¸°ì–µí•  ê²ƒ! ğŸ…
element treeê°€ object

widgetì´ ë³€ê²½í•˜ê²Œ í•˜ë©´


### ìƒíƒœê´€ë¦¬
- ìƒíƒœê´€ë¦¬ = ë³€ìˆ˜, ë°ì´í„°ì˜ ê´€ë¦¬

- ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë©´ ì•Œì•„ì„œ UIë„ ë°”ë€Œê²Œ í•  ê²ƒ

### ìƒíƒœê´€ë¦¬ ì§€ì› íŒ¨í‚¤ì§€
- ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ëŠ” setState() ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ì§€ë§Œ, ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œëŠ” ê´€ë¦¬ê°€ ì–´ë µë‹¤.
- 4ëŒ€ì¥
	- Provider
	- Bloc
	- Riverpod
	- GetX
- GetXëŠ” ì¤„ì–´ë“œëŠ” ì¶”ì„¸, RiverPodì˜ ì ìœ ìœ¨ì´ ì¢€ ë†’ì•„ì§
- ë‚˜ë¨¸ì§€ëŠ” í° ë³€í™” ì—†ìŒ

- Provider ì¶”ì²œ ì´ìœ 
	- InheritedWidgetê³¼ ê°€ì¥ í¡ì‚¬í•¨ -> ê·¼ë³¸
	- ì œì•½ì´ ë§ìŒ(ì—ëŸ¬ ë‚´ê¸° ì–´ë ¤ì›€)
	- êµ¬ê¸€ì—ì„œ ì—¬ì „íˆ ê³µì‹ì ìœ¼ë¡œ ë°€ê³  ì‡ìŒ

- Bloc
	- ëŸ¬ë‹ì»¤ë¸Œê°€ ìˆìŒ
	- ë§¤ë‹ˆì•„ì¸µ ìˆê³  ëŒ€í˜• í”„ë¡œì íŠ¸ ìœ„ì£¼ë¡œ ì‚¬ìš©í•¨

- GetX 
	- ìµœê·¼ê¹Œì§€ë„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ì§€ë§Œ, ì—¬ëŸ¬ ë‹¨ì ì´ ìˆì–´ì„œ ë¹„ì¶”ì²œ
	- í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€
	- ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
	- ì œì•½ì´ ì—†ìŒ(bug ë°œìƒë¥  ë†’ìŒ)

- Riverpod
	- í˜„ì¬ ê°€ì¥ ì¸ê¸°ìˆìŒ
	- ì½”ë“œ ì œë„¤ë ˆì´ì…˜ ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ì—†ì•´ìŒ
	- ê·¼ë³¸ê³¼ ë§ì´ ë©€ì–´ì ¸ì„œ Riverpod ìì²´ë¥¼ ê³µë¶€í•´ì•¼í•¨
	- ê¸°ëŠ¥ ìœ„ì£¼ë¡œ top levelì— ëª¨ë‘ ì •ì˜í•´ë†“ê³  ì–´ë””ì„œë“  ê°€ì ¸ë‹¤ê°€ ì“°ëŠ” ê°œë…
	- ë¦¬ë²„íŒŸë§Œì˜ ì•„í‚¤í…ì²˜ ê³µë¶€ê°€ í•„ìš”í•¨

### ChangeNotifierProvider
	-  [ViewModel]  ChangeNotifier => notifyListeners() [View]ì— ë³€ê²½ í†µì§€
	- ChangeNotifierProvier : ìœ„ì ¯ íŠ¸ë¦¬ì˜ ìµœìƒìœ„ì— ì„¤ì •, ChangeNotifierë¥¼ ê°ì‹œ
		- ë³€ê²½ì´ í•„ìš”í•œ ìœ„ì ¯ë§Œ ìë™ ê°±ì‹ 
		- ChangeNotifier ê°ì²´ë¥¼ ì œê³µ


### Provider ê¸°ë³¸ ì‚¬ìš© ë°©ë²•
- ChangeNotifierë¥¼ ì œê³µí•  ë¶€ë¶„ì— ChangeNotifierProvider ìœ„ì ¯ ë°°ì¹˜
		
	![alt text](image-166.png)

- watch() ëŠ” ì§€ì†ì ì¸ ê´€ì°°ì„ í•˜ê³  ë³€ê²½ì‹œ build() ë¥¼ ë¦¬ë¹Œë“œ í•¨. build() ë©”ì„œë“œ ë‚´ì—ì„œ ì‚¬ìš©	

	```dart
	@override
	Widget build(BuildContext context) {
		final model = context.watch<CounterModel>();
	}
	```
	![alt text](image-167.png)

- ë‹¨ë°œì„± ì´ë²¤íŠ¸ ì²˜ë¦¬(read())
	- initState() ì‚¬ìš©, ë²„íŠ¼ í´ë¦­ ë“±

	```dart
	floatingActionButton: FloatingActionButton(
		child: const Icon(Icons.add),
		onPressed: () {
			context.read<CounterModel>().increase();
		},
	),
	```
	- `Provider.of<CounterModel>(context, listen: false).increase();`ì™€ ë™ì¼í•œ ì½”ë“œ

### initState()
- initState()ì—ì„œ ì‚¬ìš© ë¶ˆê°€

	![alt text](image-165.png)


	- read()ì˜ ê²½ìš°ì—ë„ initState()ì—ì„œ Future.microtask() ì•ˆì— ë„£ì–´ì„œ ì‹¤í–‰í•´ì•¼

### didChangeDependencies()
- viewModel ì ‘ê·¼ ê°€ëŠ¥í•¨
- ë§¤ë²ˆ ì‹¤í–‰í•˜ëŠ” ì½”ë“œëŠ” ì—¬ê¸°ì— ë‘ë©´ ì•ˆë¨

### Consumer
- ëª¨ë¸ì„ ì œê³µí•  ê³³ì— Consumer ë°°ì¹˜ -> Consumerë¶€ë¶„ë§Œ ë¦¬ë¹Œë“œ ë¨
- StreamBuilder, listenableBuilder ê°™ì€ ì—­í• 
- UI ì„±ëŠ¥ì„ ê·¹í•œìœ¼ë¡œ ëŒì–´ì˜¬ë ¤ì•¼ í•  ë•Œ ê²€í† 

	![alt text](image-168.png)

## 2. í•œì¤„ ì •ë¦¬ ğŸ§¹
1. setState()ëŠ” didChangeDependencies()ê°€ ì•„ë‹ˆë¼ initState()ì—ì„œ ìµœì´ˆ í•œë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ í•˜ì
2. ìœ„ ìµœì´ˆ ì‹¤í–‰í•  ë•Œì—ë„ ë¯¸ì„¸í•˜ê²Œ ë”œë ˆì´ë¥¼ ì£¼ë„ë¡ í•¨
	```dart
	Future.microtask(() => viewModel.addListener(updateUI));
	```
3. Provider ì ìš© ì½”ë“œë© (https://codelabs.developers.google.com/codelabs/flutter-codelab-first?hl=ko#0)


## 3. ì´ë¯¸ì§€ ê²€ìƒ‰ ì•± Live Coding
ã… ì•± ìƒì„±
>Organization
 image search app1

ã… í•„ìˆ˜ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
>flutter pub add http provider build_runner freezed 
 ì„ íƒ go_router

ã… í´ë” êµ¬ì¡°
>data
>ã„´ data_source
>ã„´ mapper
>ã„´ model
>ã„´ repository
>
>presentation
>ã„´ search_list
>	search_list_screen.dart
>	search_list_view_model.dart
>ã„´ photo_detail
>	phto_detail_screen.dart
 
ã… git ì—°ê²°
>git init / git add . / git push
  git publish (vscode)

ã… dataë¶€í„°
ã…‡ model class
> required int id ,
> required String url,
> required String tags,

build

ã…‡ repository
abstract interface class PhotoRepository
**ìŠ¤ë‹ˆí« ë§Œë“¤ì**
```dart
Future<List<Photo>> getPhotos(String query)
```

ã…‡ dto
json ê¸ì–´ì„œ Json to dto

ã…‡ data_source
PhotoDataSource
final `_baseRul` = 'https://pixabay. com/api';

```dart
Future<PhotoResultDto> getPhotoResult(String query) async {
	final response = http.get(Uri.parse('$_baseUrl?key=36206009-fe028570b3c99a317c543088c&q=%$query$&image_type=photo'));

	return PhotoResultDto.fromJson(jsonDecode(response.body));
	
}
```

ã…‡ mapper
```
extension ToPhoto on Hits {
	Photo toPhoto() {
		return Photo(
			id: id?.toInt(), // ì˜ëª»ë“¤ì–´ì˜¨ ê±´ í„°ëœ¨ë¦°ë‹¤ëŠ” ê²ƒ // ?? 0 ì•ˆì”€
			url: previewURL ?? '',
			tags: tags ?? '',
		)
	} 
}
```


ã…‡ PhotoRepositoryImpl
```dart
PhotoDataSource
named constructor

@override
Future<list<Photo>> getPhotos(String query) async{
	final dto = `_photoDataSource.getPhotoResult(query);

	if (dto.hits == null) {
		return [];
	}
	return dto.hits!.map((e) => e.toPhoto()).toList();
}
```

ã… ViewModel
ã…‡ SearchListViewModel with ChangeNotifier
```dart

final PhotoRepository _photoRepository;_

SearchListViewModel({ required ..}) : _photoRepository = photoRepository;

List<Photo> _photo = []; // ìˆ¨ê¹€

List<Photo> get photo => List.unmodifiable(_photo); // ë³€ê²½ëª»í•˜ê²Œ

void onSearch(String query) async {
	_photos = await _photoRepository.getphotos(query);
	notifyListeners();
}

```


ã… main

home: const SearchListScreen();


ã… View
ã…‡ SearchList (StateFul) -> ê²€ìƒ‰í•˜ë©´ ë‹¤ì‹œ ë„ì›Œì¤˜ì•¼í•˜ë¯€ë¡œ

**Snippet -> TextField**

```dart

// ê°€ì§œë°ì´í„° providerì—°ê²°í•˜ê³  ì§€ìš°ë©´ ë¨
final potos = [
	Photo(id: 1, url: 'https://....;'),
	Photo(....),

];

State

final  _queryTextEditingController = TextEditingController();

@override
vodi dispose() {
	_query ... controller.dispose();
	super.dispose();
}

@override
Widget build(BuildContext context){
	// final viewModel = context.watch<SearchListViewModel>();
	// ì„¸íŒ… ì•ˆë˜ê¸° ì „ì— provider ì“°ë©´ ì•ˆë¨
	// ê°€ì§œ ë°ì´í„° ê°€ì§€ê³  ë§Œë“¤ê³  ë§ˆì§€ë§‰ì— ì—°ê²°
	// setState()ëŒ€ì‹  ê´€ì°°í•´ì„œ 

	return Scaffold(
	appBar: AppBar(
		title: const Text('ì´ë¯¸ì§€ ê²€ìƒ‰ 1'),
	),
	body: Column(
		children: [
			TextField(
				decoration: InputDecoration(
					border: OutlineInputBorder(),
					hintText: 'ê²€ìƒ‰ì–´',
					suffixIcon: IconButton(
						icon: Icon(Icons.search),
						onPressed: () {
							final query = _queryTextEditingController.text;
							viewModel.onSearch(query);
							// await ì“°ì§€ ì•ŠëŠ” ê²ƒì€ viewì—ì„œ ë¡œì§ì—ëŠ” ê°œì…í•˜ì§€ ì•Šê² ë‹¨ 
						},
					
					),	
				),				
			),
			GridView.count( // Column ì•ˆì— GridView ë„£ìœ¼ë©´ ì•ˆë¨ -> Expandedë¡œ ê°
				padding: ..
				crossAxixSpacing: 10,
				crossAxisCount: 2,
				children: viewModel.photos.map((e) => Image.network(e.url, fit: BoxFit.cover, // Imageë¥¼ ê°ì‹¸ì„œ ClipRRect(
					borderRadius: BorderRadius.cicular(20),
					child: Image(ê°€ì§œë°ì´í„° -> ViewModel.photo)
				)
				),).toList(),
			),
		]	
	)
	
	
}

```
ã… main
**Snippet** 
cnpë¡œ ë“±ë¡
![[Pasted image 20240411233420.png]]
```dart
	home: ChangeNotifierProvider(
		create: (BuildContext conetxt) {
			return SearchListViewModel(photoRepository: PhotoRepositoryImpl(photoDataSource: PhotoDataSource(),),);			
		},
		child: SearchListScreen(),
	),
// ì›ë˜ ì´ê±´ë°?

craete: (_) => SearchListViewModel(
	photoRepository: PhotoRepositoryImpl(
		photoDataSource: PhotoDataSource(),
	),
),
child: SearchListScreen(),
...

``` 

ã… ViewModel (loading ì²˜ë¦¬)
```dart

final PhotoRepository _photoRepository;_

SearchListViewModel({ required ..}) : _photoRepository = photoRepository;

List<Photo> _photo = []; // ìˆ¨ê¹€

List<Photo> get photo => List.unmodifiable(_photo); // ë³€ê²½ëª»í•˜ê²Œ

bool _isLoading = false;

bool get isLoading => _isLoading;

void onSearch(String query) async {
// ì—¬ê¸°ì—ë‹¤ê°€ ì¼ë¶€ëŸ¬ Futureë¥¼ ì•ˆë„£ì–´ì„œ viewì—ì„œ await ì—†ì´ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ í•¨ 
	_isLoading = true;
	notifyListeners();

	_photos = await _photoRepository.getphotos(query);
	_isLoading = false;
	notifyListeners();
}

```

ã… View
Expanded(

	child: viewModel.isLoading ? Center(child: CircularProgressIndicator()) : GridView.count(...)
)

ã… ì¸í„°ë„· ê¶Œí•œ ì½”ë“œ (debug -> src/AndroidManifest.xmlì— ë³µì‚¬í•´ì•¼í•¨)
![[Pasted image 20240411235930.png]]
